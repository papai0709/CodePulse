{% extends "base.html" %}

{% block content %}
<div class="hero-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h1 class="display-4 mb-4">
                    <i class="fab fa-github text-primary me-3"></i>
                    GitHub Repository Analyzer
                </h1>
                <p class="lead mb-5">
                    Analyze any GitHub repository for test coverage, code quality, security issues, and get actionable improvement recommendations.
                </p>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Analysis Form -->
            <div class="card shadow-lg border-0 mb-5">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-search me-2"></i>
                        Analyze Repository
                    </h3>
                </div>
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('analyze_repository') }}" id="analyzeForm">
                        <div class="mb-3">
                            <label for="repo_url" class="form-label">
                                <i class="fab fa-github me-2"></i>
                                GitHub Repository URL
                            </label>
                            <input 
                                type="url" 
                                class="form-control form-control-lg" 
                                id="repo_url" 
                                name="repo_url" 
                                placeholder="https://github.com/owner/repository"
                                required
                            >
                            <div class="form-text">
                                Enter the full URL of any GitHub repository
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input 
                                    class="form-check-input" 
                                    type="checkbox" 
                                    id="is_public" 
                                    name="is_public"
                                    checked
                                >
                                <label class="form-check-label" for="is_public">
                                    <i class="fas fa-globe me-2"></i>
                                    This is a public repository
                                </label>
                                <div class="form-text">
                                    <small class="text-muted">
                                        Uncheck this if analyzing a private repository (requires GitHub token)
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- AI Enhancement Option -->
                        <div class="mb-4">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <div class="form-check">
                                        <input 
                                            class="form-check-input" 
                                            type="checkbox" 
                                            id="enable_ai" 
                                            name="enable_ai"
                                        >
                                        <label class="form-check-label" for="enable_ai">
                                            <i class="fas fa-robot text-primary me-2"></i>
                                            <strong>Enable AI-Enhanced Analysis</strong>
                                            <span class="badge bg-primary ms-2">NEW</span>
                                        </label>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            Get intelligent insights, context-aware recommendations, and automated improvement roadmaps powered by AI
                                        </small>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge badge-theme-adaptive">üß† Intelligent Code Review</span>
                                        <span class="badge badge-theme-adaptive">üîç Context-Aware Analysis</span>
                                        <span class="badge badge-theme-adaptive">üó∫Ô∏è Auto Roadmaps</span>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-warning">
                                            <i class="fas fa-key me-1"></i>
                                            Requires GitHub token for AI features
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="analyzeBtn">
                                <i class="fas fa-chart-line me-2"></i>
                                <span id="analyzeText">Analyze Repository</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="text-center mb-5">
                <span class="text-primary">üîç</span> What We Analyze
            </h2>
        </div>
        <div class="col-md-6 col-lg-3 mb-4 slide-in-left">
            <div class="card h-100 border-0 shadow-sm border-success">
                <div class="card-body text-center">
                    <div class="feature-icon bg-success mx-auto mb-3">
                        <i class="fas fa-vial"></i>
                    </div>
                    <h5 class="card-title text-success">üß™ Test Coverage</h5>
                    <p class="card-text">
                        Analyzes unit test coverage, test quality, and identifies untested code areas with detailed metrics.
                    </p>
                    <div class="mt-3">
                        <span class="badge bg-success">Coverage Analysis</span>
                        <span class="badge bg-info">Quality Metrics</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-4 slide-in-left" style="animation-delay: 0.1s;">
            <div class="card h-100 border-0 shadow-sm border-danger">
                <div class="card-body text-center">
                    <div class="feature-icon bg-danger mx-auto mb-3">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h5 class="card-title text-danger">üõ°Ô∏è Security Issues</h5>
                    <p class="card-text">
                        Detects security vulnerabilities, hardcoded secrets, and potential attack vectors in your code.
                    </p>
                    <div class="mt-3">
                        <span class="badge bg-danger">Vulnerability Scan</span>
                        <span class="badge bg-warning">Secret Detection</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-4 slide-in-right" style="animation-delay: 0.2s;">
            <div class="card h-100 border-0 shadow-sm border-warning">
                <div class="card-body text-center">
                    <div class="feature-icon bg-warning mx-auto mb-3">
                        <i class="fas fa-code"></i>
                    </div>
                    <h5 class="card-title text-warning">‚ö° Code Quality</h5>
                    <p class="card-text">
                        Identifies code smells, complexity issues, and maintainability problems with actionable insights.
                    </p>
                    <div class="mt-3">
                        <span class="badge bg-warning">Code Smells</span>
                        <span class="badge bg-info">Complexity Check</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-4 slide-in-right" style="animation-delay: 0.3s;">
            <div class="card h-100 border-0 shadow-sm border-info">
                <div class="card-body text-center">
                    <div class="feature-icon bg-info mx-auto mb-3">
                        <i class="fas fa-book"></i>
                    </div>
                    <h5 class="card-title text-info">üìö Documentation</h5>
                    <p class="card-text">
                        Checks for missing documentation, README quality, and code comments comprehensiveness.
                    </p>
                    <div class="mt-3">
                        <span class="badge bg-info">README Analysis</span>
                        <span class="badge bg-success">Comment Check</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h5>Analyzing Repository...</h5>
                <p class="text-muted mb-0">This may take a few minutes depending on repository size</p>
                <div class="progress mt-3">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 100%"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('analyzeForm');
    const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
    
    // Handle form submission
    form.addEventListener('submit', function(e) {
        loadingModal.show();
    });
    
    // Auto-validate GitHub URL
    const repoInput = document.getElementById('repo_url');
    repoInput.addEventListener('input', function() {
        const url = this.value;
        const githubPattern = /^https:\/\/github\.com\/[\w\-\.]+\/[\w\-\.]+\/?$/;
        
        if (url && !githubPattern.test(url)) {
            this.setCustomValidity('Please enter a valid GitHub repository URL');
        } else {
            this.setCustomValidity('');
        }
    });
    
    // Handle public/private checkbox
    const isPublicCheckbox = document.getElementById('is_public');
    const formText = document.querySelector('.form-text');
    
    isPublicCheckbox.addEventListener('change', function() {
        if (this.checked) {
            formText.innerHTML = 'Enter the full URL of any GitHub repository';
        } else {
            formText.innerHTML = 'Enter the full URL of any GitHub repository<br><small class="text-warning">‚ö†Ô∏è Private repository analysis requires a GitHub token in .env file</small>';
        }
    });

    // Handle AI enhancement checkbox
    const useAiCheckbox = document.getElementById('use_ai');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const analyzeText = document.getElementById('analyzeText');
    
    useAiCheckbox.addEventListener('change', function() {
        if (this.checked) {
            analyzeBtn.classList.add('btn-gradient');
            analyzeText.innerHTML = '<i class="fas fa-robot me-2"></i>AI-Enhanced Analysis';
        } else {
            analyzeBtn.classList.remove('btn-gradient');
            analyzeText.innerHTML = '<i class="fas fa-chart-line me-2"></i>Analyze Repository';
        }
    });
});
</script>
{% endblock %}